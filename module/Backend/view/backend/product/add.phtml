<?php
$arrParams = $this->arrParams;
$arrCategorList = $this->arrCategoryList;
$arrBrandList = $this->arrBrandList;
$arrTagList = $this->arrTagList;
$errors = $this->errors;
?>

<section class="wrapper site-min-height">
    <?php if ($errors['product']): ?>
        <div class="alert alert-block alert-danger fade in">
            <button class="close close-sm" type="button" data-dismiss="alert">
                <i class="fa fa-times"></i>
            </button>
            <h4><i class="fa fa-times-sign"></i> Lỗi!</h4>
            <p> - <?php echo $errors['product']; ?></p>
        </div>
    <?php endif; ?>

    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <div class="row">
                    <div class="col-lg-12">
                        <section class="panel panel-primary">
                            <header class="panel-heading">Thêm sản phẩm mới</header>
                            <div class="panel-body">
                                <form method="POST" role="form" class="form-horizontal tasi-form" id="frm">
                                    <div class="col-lg-12">
                                        <div class="form-group">
                                            <label for="prod_name" class="col-lg-2 control-label" value="">Tên sản phẩm</label>
                                            <div class="col-lg-10">
                                                <input type="text" value="<?php echo $this->params["prod_name"] ?>" placeholder="Nhập Tên sản phẩm" class="form-control" name="prod_name" id="prod_name">
                                                <?php if ($errors['prod_name']): ?>
                                                    <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['prod_name']; ?></strong></span>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="prod_name" class="col-lg-2 control-label" value="">Mã sản phẩm</label>
                                            <div class="col-lg-10">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <input type="text" value="<?php echo $this->params["prod_code"] ?>" placeholder="Nhập Mã sản phẩm" class="form-control" name="prod_code" id="prod_name">
                                                    </div>
                                                </div>
                                                <span class="help-block color-danger"><strong>lưu ý</strong>: Nếu không nhập mã hệ thống sẽ tự động tạo ra mã sản phẩm</span>
                                            </div>

                                        </div>
                                        <div class="form-group">
                                            <label for="prod_slug" class="col-lg-2 control-label" value="">URL:</label>
                                            <div class="col-lg-10">
                                                <input type="text" value="<?php echo $this->params["prod_slug"] ?>" placeholder="Nhập URL" class="form-control" name="prod_slug" id="productURL">
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_actived" class="col-lg-2 control-label">Trạng thái</label>
                                            <div class="col-lg-10">
                                                <select class="form-control sumo-select-box" id="prod_status" name="prod_actived">    
                                                    <option value="1" <?php echo isset($this->params['prod_actived']) && $this->params['prod_actived'] == 1 ? 'selected="selected"' : ''; ?>>Hiện</option>
                                                    <option value="0" <?php echo isset($this->params['prod_actived']) && $this->params['prod_actived'] == 0 ? 'selected="selected"' : ''; ?>>Ẩn</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_status" class="col-lg-2 control-label">Tình trạng</label>
                                            <div class="col-lg-10">
                                                <select class="form-control sumo-select-box" id="prod_status" name="prod_status">    
                                                    <option value="1" <?php echo isset($this->params['prod_status']) && $this->params['prod_status'] == 1 ? 'selected="selected"' : ''; ?>>Còn hàng</option>
                                                    <option value="0" <?php echo isset($this->params['prod_status']) && $this->params['prod_status'] == 0 ? 'selected="selected"' : ''; ?>>Hết hàng</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="cate_id" class="col-lg-2 control-label">Thuộc danh mục</label>
                                            <div class="col-lg-4 width-fix">
                                                <select name="cate_id" class="selectbox selectpicker" data-live-search="true" title="Chọn danh mục" id="cate_id">
                                                    <?php
                                                    if (is_array($this->params['cate_id']))
                                                        $listCate = $this->params['cate_id'];
                                                    else
                                                        $listCate = explode(',', $this->params['cate_id']);
                                                    foreach ($this->arrCategoryList as $category) {
                                                        if ($category["cate_type"] == 0) {
                                                            $depth = substr_count($category['cate_grade'], ':') - 1;
                                                            $str = $depth > 0 ? str_repeat('&nbsp;&nbsp;&nbsp;', $depth - 1) . '&rdsh;&nbsp;' : '';
                                                            ?>
                                                            <option <?php echo in_array($category['cate_id'], $listCate) ? 'selected="selected"' : '' ?> value="<?php echo $category['cate_id'] ?>"><?php echo $str . $category['cate_name'] ?></option>
                                                            <?php
                                                        }
                                                    }
                                                    ?>
                                                </select>
                                            </div>
                                            <?php if ($errors['cate_id']): ?>
                                                <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['cate_id']; ?></strong></span>
                                            <?php endif; ?>
                                        </div>

                                        <div class="form-group">
                                            <label for="bran_id" class="col-lg-2 control-label">Thương hiệu</label>
                                            <div class="col-lg-4 width-fix">
                                                <select name="bran_id" class="selectbox selectpicker" data-live-search="true" title="Chọn thương hiệu" id="bran_id">
                                                    <?php
                                                    foreach ($arrBrandList as $arrBrand) :
                                                        $brandId = $arrBrand['bran_id'];
                                                        $brandName = $arrBrand['bran_name'];
                                                        $selected = $params['bran_id'] == $brandId ? 'selected = "selected"' : '';
                                                        ?>
                                                        <option value="<?php $brandId; ?>" <?php echo $selected; ?>><?php echo $brandName; ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>

                                            <?php if ($errors['bran_id']): ?>
                                                <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['bran_id']; ?></strong></span>
                                            <?php endif; ?>
                                        </div>

                                        <div class="form-group">
                                            <label for="tags_id" class="col-lg-2 control-label">Chọn Tags: </label>

                                            <div class="col-lg-4 width-fix">
                                                <select name="tags_id" class="selectbox selectpicker" multiple="multiple" data-live-search="true" title="Chọn tag cho sản phẩm" id="tags_id">
                                                    <?php
                                                    foreach ($arrTagList as $arrTag) :
                                                        $tagId = $arrTag['tags_id'];
                                                        $tagName = $arrTag['tags_name'];
                                                        $selected = $params['tags_id'] == $tagId ? 'selected = "selected"' : '';
                                                        ?>
                                                        <option value="<?php $tagId; ?>" <?php echo $selected; ?>><?php echo $tagName; ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>

                                            <?php if ($errors['tags_id']): ?>
                                                <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['tags_id']; ?></strong></span>
                                            <?php endif; ?>

                                        </div>

                                        <div class="form-group">
                                            <label for="prod_price"  class="col-lg-2 control-label">Loại sản phẩm</label>
                                            <div class="col-lg-10">
                                                <div class="col-lg-4">
                                                    <input type="checkbox" value="1"  <?php echo ($this->params["prod_is_promotion"] == 1) ? "checked" : ""; ?> name="prod_is_promotion"/>  Sản phẩm khuyến mãi
                                                </div>
                                                <div class="col-lg-4">
                                                    <input type="checkbox" value="1"  <?php echo ($this->params["prod_bestselling"] == 1) ? "checked" : ""; ?> name="prod_bestselling"/>  Sản phẩm bán chạy
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_price"  class="col-lg-2 control-label">Giá bán  ( VNĐ )</label>
                                            <div class="col-lg-4">
                                                <input type="text" value="<?php echo ($this->params["prod_price"] != "") ? $this->params["prod_price"] : 0; ?>" placeholder="Nhập Giá bán" class="form-control price-mask" name="prod_price" id="prod_price">
                                            </div>

                                            <?php if ($errors['prod_price']): ?>
                                                <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['prod_price']; ?></strong></span>
                                            <?php endif; ?>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_promotion_price" class="col-lg-2 control-label">Giá khuyến mãi ( VNĐ )</label>
                                            <div class="col-lg-4">
                                                <input type="text" value="<?php echo ($this->params["prod_promotion_price"] != "") ? $this->params["prod_promotion_price"] : 0; ?>" placeholder="Nhập Giá bán" class="form-control price-mask" name="prod_promotion_price" id="prod_promotion_price">
                                            </div>
                                            <?php if ($errors['prod_promotion_price']): ?>
                                                <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['prod_promotion_price']; ?></strong></span>
                                            <?php endif; ?>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_description" class="col-lg-2 control-label">Mô tả ngắn về sản phẩm</label>
                                            <div class="col-lg-10">
                                                <textarea rows="6" name="prod_description" id="prod_description" class="form-control editor" style="">
                                                    <?php echo $this->params['prod_description']; ?>
                                                </textarea>
                                                <?php if ($errors['prod_description']): ?>
                                                    <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['prod_description']; ?></strong></span>
                                                <?php endif; ?>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_detail" class="col-lg-2 control-label">Chi tiết sản phẩm</label>
                                            <div class="col-lg-10">
                                                <textarea rows="20" value="" name="prod_detail" id="prod_detail" class="form-control editor">
                                                    <?php echo $this->params['prod_detail']; ?>
                                                </textarea>
                                                <?php if ($errors['prod_detail']): ?>
                                                    <span class="help-block color-danger"><strong> <i class="icon-exclamation-sign"></i> <?php echo $errors['prod_detail']; ?></strong></span>
                                                <?php endif; ?>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_meta_robot" class="col-lg-2 control-label">Meta Robot: </label>
                                            <div class="col-lg-4">
                                                <select class="form-control" id="prod_meta_robot" name="prod_meta_robot">    
                                                    <option value="index,follow" <?php echo isset($this->params['prod_meta_robot']) && $this->params['prod_meta_robot'] == 'index,follow' ? 'selected="selected"' : ''; ?>>Index,Follow</option>
                                                    <option value="noindex" <?php echo isset($this->params['prod_meta_robot']) && $this->params['prod_meta_robot'] == 'noindex' ? 'selected="selected"' : ''; ?>>Noindex</option>
                                                    <option value="index" <?php echo isset($this->params['prod_meta_robot']) && $this->params['prod_meta_robot'] == 'index' ? 'selected="selected"' : ''; ?>>Index</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="prod_meta_title" class="col-lg-2 control-label">SEO Title: </label>
                                            <div class="col-lg-10">
                                                <input type="text" value="<?php echo $this->params['prod_meta_title']; ?>" placeholder="Nhập SEO Title" class="form-control" name="prod_meta_title" id="prod_meta_title">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="prod_meta_keyword" class="col-lg-2 control-label">SEO Keywords: </label>
                                            <div class="col-lg-10">
                                                <input type="text" value="<?php echo $this->params['prod_meta_keyword']; ?>"  placeholder="Nhập SEO Keywords " class="form-control" name="prod_meta_keyword" id="prod_meta_keyword">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="prod_meta_description" class="col-lg-2 control-label">SEO Description: </label>
                                            <div class="col-lg-10">
                                                <textarea placeholder="Nhập SEO Description" class="form-control" name="prod_meta_description" id="prod_meta_description"><?php echo $this->params['prod_meta_description']; ?></textarea>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_meta_description" class="col-lg-2 control-label">Hình ảnh chính: </label>
                                            <div class="col-lg-5">
                                                <div class="form">
                                                    <div class="form-group">                                                       
                                                        <div class="col-lg-12">
                                                            <div>
                                                                <input type="file" name="prod_image" id="prod_image" class="ignore"/>
                                                            </div>
                                                            <div id="progress"></div>
                                                            <ul class="image-list">
                                                                <?php
                                                                $arr = json_decode($this->params['prod_image'], true);
                                                                if (isset($arr["sourceImage"]) && isset($arr["thumbImage"]["120x120"])) {
                                                                    ?>
                                                                    <li class="newImage" style="background: none repeat scroll 0 0 #FFFFFF;border: 1px solid #DDDDDD;border-radius: 2px 2px 2px 2px;box-shadow: 1px 1px 2px #EEEEEE;float: left;margin: 0 5px 5px 0;padding: 5px;list-style:none outside none;margin-bottom:10px;display:inline;">
                                                                        <img class="image" src="<?php echo $arr["thumbImage"]["50x50"] ?>" alt="" style="display: block;margin-bottom: 10px;">
                                                                        <span style="display: block;text-align: right;">
                                                                            <a title="Xem" class="view" href="<?php echo $arr["sourceImage"] ?>" target="_blank" style="vertical-align: middle;cursor: pointer;display: inline-block;height: 16px;margin-left: 5px;opacity: 0.5;vertical-align: middle;width: 16px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNqk00soRFEcx/Ez4yIhWSClWNiR0mQjeawssJGVLJTMBnksJNnZeWTDRnntZGdhoWxsJERK2UgTK5mFYrzSXN9TPzVzulPkX5/unXPv/M45/3tvKBqNGpWHRkygFUW4xR5WcWUCKqxjDsZxiA684w55GMIpBhEKCrCD7ZjDK5ZQi0pUYwofWkVXUICdZRI+VnQe13UbOI9p/R5DuRuQiybEMGuCa03ba0OpG+Dp3C7zOUOAvfaY0uy0ANuwN60kx2SuYm3pxQ34xC4qMJzhzz1owQbu3QC7vGVkYwYjms2owb1YRBKbWoUxzn5ONLu9cQF9eECJHmmBVtqJayR+ArIikYhR+gWO1eV61Gl8y96n96IZ+ThSYFpHv3CAc5SpqU96I6uwDTvbKAp1THhOs5J6ieLO+I0auYMGDOhb6Q+b31dMIWcpT6bGM38ru51urGMflyHf981/6luAAQBAI081YdVfOQAAAABJRU5ErkJggg==);"></a><a title="Xóa" class="delete" style="vertical-align: middle;cursor: pointer;display: inline-block;height: 16px;margin-left: 5px;opacity: 0.5;vertical-align: middle;width: 16px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAK1JREFUeNpi/P//PwMySE9PPwmkzBgwwZqZM2eGogsyYVGITTMIhGATZMGhWA9o22UkV9kAqcPYFDKmpaU9AdLSDKSDrUBLfEBeeM1AAWCEBSLQmR+AFD8Q+wDxFphXgPgSlA0TfwS0WR5fIB6BMZDDAVmcUCyQBKhqACelBrANuBdgQAgpBcohiYsSMuARlL6HJPYQiX0bSn/EZUAukiG4wH0gLsOaEskFAAEGAE+1LkibLuYpAAAAAElFTkSuQmCC);"></a>
                                                                            <div id="jsonData"><input name="prod_image" type="hidden" value="<?php echo htmlentities($this->params['prod_image']); ?>"></div>
                                                                        </span>
                                                                    </li>
                                                                <?php } ?>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="prod_image_sub" class="col-lg-2 control-label">Hình ảnh slide: </label>
                                            <div class="col-lg-5">
                                                <div class="form">
                                                    <div class="form-group">
                                                        <div class="col-lg-12">
                                                            <div>
                                                                <input type="file" name="prod_image_sub" id="prod_image_sub" class="ignore"/>
                                                            </div>
                                                            <div id="sub-progress"></div>
                                                            <ul class="sub-image-list">
                                                                <?php
                                                                if (isset($this->params['prod_image_sub']) && count($this->params['prod_image_sub']) > 0) {
                                                                    foreach ($this->params['prod_image_sub'] as $key => $value) {
                                                                        $arr = json_decode($value, true);
                                                                        if (isset($arr["sourceImage"]) && isset($arr["thumbImage"]["120x120"])) {
                                                                            ?>
                                                                            <li class="newImage" style="background: none repeat scroll 0 0 #FFFFFF;border: 1px solid #DDDDDD;border-radius: 2px 2px 2px 2px;box-shadow: 1px 1px 2px #EEEEEE;float: left;margin: 0 5px 5px 0;padding: 5px;list-style:none outside none;margin-bottom:10px;display:inline;">
                                                                                <img class="image" src="<?php echo $arr["thumbImage"]["50x50"] ?>" alt="" style="display: block;margin-bottom: 10px;">
                                                                                <span style="display: block;text-align: right;">
                                                                                    <a title="Xem" class="view" href="<?php echo $arr["sourceImage"] ?>" target="_blank" style="vertical-align: middle;cursor: pointer;display: inline-block;height: 16px;margin-left: 5px;opacity: 0.5;vertical-align: middle;width: 16px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAWJJREFUeNqk00soRFEcx/Ez4yIhWSClWNiR0mQjeawssJGVLJTMBnksJNnZeWTDRnntZGdhoWxsJERK2UgTK5mFYrzSXN9TPzVzulPkX5/unXPv/M45/3tvKBqNGpWHRkygFUW4xR5WcWUCKqxjDsZxiA684w55GMIpBhEKCrCD7ZjDK5ZQi0pUYwofWkVXUICdZRI+VnQe13UbOI9p/R5DuRuQiybEMGuCa03ba0OpG+Dp3C7zOUOAvfaY0uy0ANuwN60kx2SuYm3pxQ34xC4qMJzhzz1owQbu3QC7vGVkYwYjms2owb1YRBKbWoUxzn5ONLu9cQF9eECJHmmBVtqJayR+ArIikYhR+gWO1eV61Gl8y96n96IZ+ThSYFpHv3CAc5SpqU96I6uwDTvbKAp1THhOs5J6ieLO+I0auYMGDOhb6Q+b31dMIWcpT6bGM38ru51urGMflyHf981/6luAAQBAI081YdVfOQAAAABJRU5ErkJggg==);"></a><a title="Xóa" class="delete" style="vertical-align: middle;cursor: pointer;display: inline-block;height: 16px;margin-left: 5px;opacity: 0.5;vertical-align: middle;width: 16px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAK1JREFUeNpi/P//PwMySE9PPwmkzBgwwZqZM2eGogsyYVGITTMIhGATZMGhWA9o22UkV9kAqcPYFDKmpaU9AdLSDKSDrUBLfEBeeM1AAWCEBSLQmR+AFD8Q+wDxFphXgPgSlA0TfwS0WR5fIB6BMZDDAVmcUCyQBKhqACelBrANuBdgQAgpBcohiYsSMuARlL6HJPYQiX0bSn/EZUAukiG4wH0gLsOaEskFAAEGAE+1LkibLuYpAAAAAElFTkSuQmCC);"></a>
                                                                                    <div id="jsonData"><input name="prod_image_sub[]" type="hidden" value="<?php echo htmlentities($value); ?>"></div>
                                                                                </span>
                                                                            </li>
                                                                            <?php
                                                                        }
                                                                    }
                                                                }
                                                                ?>


                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-group">
                                            <div class="col-lg-offset-2 col-lg-10">
                                                <button type="submit" id="done" class="btn btn-success bt-save" name="save"><i class="icon-save"></i> Lưu</button>  
                                                <button type="submit" id="done" class="btn btn-success bt-save" name="save_close"><i class="icon-save"></i> Lưu & Thoát</button> 
                                                <input value="0" name="is_close" class="is_close" type="hidden" />
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
            </section>
        </div>
    </div>
</section>
<script type="text/javascript">
    getTagURL = '<?php echo $this->serverUrl() . $this->Url('backend', array('controller' => 'tags', 'action' => 'get-tag')); ?>';
    Product.index();
    Product.upload();
</script>